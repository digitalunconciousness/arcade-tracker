{% extends "base.html" %}

{% block content %}
<h1>‚úèÔ∏è Edit Game: {{ game.name }}</h1>

{% if game.image_filename %}
<div style="text-align: center; margin: 20px 0;">
    <img src="{{ url_for('static', filename='uploads/' + game.image_filename) }}" 
         alt="{{ game.name }} Cabinet" 
         style="max-width: 200px; max-height: 250px; border-radius: 8px; border: 2px solid var(--neon-cyan); box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);">
    <p style="color: var(--text-secondary); margin: 10px 0;">Current cabinet image</p>
</div>
{% endif %}

<form method="POST" enctype="multipart/form-data">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
    <div class="form-group">
        <label for="name">Game Name *</label>
        <input type="text" id="name" name="name" value="{{ game.name }}" required>
    </div>
    
    <div class="form-group">
        <label for="manufacturer">Manufacturer</label>
        <input type="text" id="manufacturer" name="manufacturer" value="{{ game.manufacturer or '' }}">
    </div>
    
    <div class="form-group">
        <label for="year">Year</label>
        <input type="number" id="year" name="year" min="1970" max="2030" value="{{ game.year or '' }}">
    </div>
    
    <div class="form-group">
        <label for="genre">Genre</label>
        <input type="text" id="genre" name="genre" value="{{ game.genre or '' }}">
    </div>
    
    <div class="form-group">
        <label for="location">Location *</label>
        <select id="location" name="location" onchange="toggleLocationFields()" required>
            <option value="Warehouse" {{ 'selected' if game.location == 'Warehouse' else '' }}>Warehouse</option>
            <option value="Floor" {{ 'selected' if game.location == 'Floor' else '' }}>Floor</option>
            <option value="Shipped" {{ 'selected' if game.location == 'Shipped' else '' }}>Shipped</option>
        </select>
    </div>
    
    <div class="form-group" id="warehouse_section_group" {{ 'style="display: none;"' if game.location != 'Warehouse' else '' }}>
        <label for="warehouse_section">Warehouse Section</label>
        <input type="text" id="warehouse_section" name="warehouse_section" value="{{ game.warehouse_section or '' }}" placeholder="e.g., Section A, Row 3">
    </div>
    
    <div class="form-group" id="floor_position_group" {{ 'style="display: none;"' if game.location != 'Floor' else '' }}>
        <label for="floor_position">Floor Position</label>
        <input type="text" id="floor_position" name="floor_position" value="{{ game.floor_position or '' }}" placeholder="e.g., Near entrance, Back wall">
    </div>
    
    <div class="form-group">
        <label for="status">Status</label>
        <select id="status" name="status">
            <option value="Working" {{ 'selected' if game.status == 'Working' else '' }}>Working</option>
            <option value="Being_Fixed" {{ 'selected' if game.status == 'Being_Fixed' else '' }}>Being Fixed</option>
            <option value="Not_Working" {{ 'selected' if game.status == 'Not_Working' else '' }}>Not Working</option>
            <option value="Retired" {{ 'selected' if game.status == 'Retired' else '' }}>Retired</option>
        </select>
    </div>
    
    <div class="form-group">
        <label for="coins_per_play">Coins Per Play ($)</label>
        <input type="number" id="coins_per_play" name="coins_per_play" step="0.01" value="{{ game.coins_per_play }}" min="0">
    </div>
    
    <div class="form-group">
        <label for="counter_status">Counter Status</label>
        <select id="counter_status" name="counter_status" onchange="toggleCounterFields()">
            <option value="Working" {{ 'selected' if game.counter_status == 'Working' else '' }}>Working Counter</option>
            <option value="No_Counter" {{ 'selected' if game.counter_status == 'No_Counter' else '' }}>No Counter</option>
            <option value="Broken_Counter" {{ 'selected' if game.counter_status == 'Broken_Counter' else '' }}>Broken Counter</option>
        </select>
    </div>
    
    {% if not has_play_records %}
    <div class="form-group" id="initial_coin_count_group" {{ 'style="display: none;"' if game.counter_status != 'Working' else '' }}>
        <label for="initial_coin_count">Initial Coin Count (Baseline Plays)</label>
        <input type="number" id="initial_coin_count" name="initial_coin_count" min="0" placeholder="0">
        <small style="color: var(--text-secondary);">üí∞ Since this game has no play records yet, you can set a baseline coin count if the machine already has plays on it</small>
    </div>
    {% endif %}
    
    <div class="form-group" id="counter_notes_group" {{ 'style="display: none;"' if game.counter_status == 'Working' else '' }}>
        <label for="counter_notes">Counter Notes</label>
        <textarea id="counter_notes" name="counter_notes" rows="2" placeholder="Additional details about the counter status...">{{ game.counter_notes or '' }}</textarea>
    </div>
    
    <div class="form-group">
        <label for="cabinet_image">üì∏ Update Cabinet Photo</label>
        <input type="file" id="image" name="image" accept=".png,.jpg,.jpeg,.gif">
        <small style="color: var(--text-secondary);">Upload a new photo to replace the current image (PNG, JPG, GIF - max 16MB)</small>
    </div>
    
    <div class="form-group">
        <label for="notes">Notes</label>
        <textarea id="notes" name="notes" rows="3" placeholder="Any additional notes about this game...">{{ game.notes or '' }}</textarea>
    </div>
    
    <div style="display: flex; gap: 10px; align-items: center; margin-top: 20px;">
        <button type="submit" class="btn btn-success">üíæ Save Changes</button>
        <a href="{{ url_for('game_detail', game_id=game.id) }}" class="btn" style="background: #6c757d; color: white; text-decoration: none;">Cancel</a>
    </div>
</form>

<script>
function toggleLocationFields() {
    const location = document.getElementById('location').value;
    const warehouseGroup = document.getElementById('warehouse_section_group');
    const floorGroup = document.getElementById('floor_position_group');
    
    if (location === 'Floor') {
        warehouseGroup.style.display = 'none';
        floorGroup.style.display = 'block';
    } else if (location === 'Warehouse') {
        warehouseGroup.style.display = 'block';
        floorGroup.style.display = 'none';
    } else {
        warehouseGroup.style.display = 'none';
        floorGroup.style.display = 'none';
    }
}

function toggleCounterFields() {
    const counterStatus = document.getElementById('counter_status').value;
    const coinCountGroup = document.getElementById('initial_coin_count_group');
    const counterNotesGroup = document.getElementById('counter_notes_group');
    
    if (counterStatus === 'Working') {
        if (coinCountGroup) coinCountGroup.style.display = 'block';
        counterNotesGroup.style.display = 'none';
    } else {
        if (coinCountGroup) coinCountGroup.style.display = 'none';
        counterNotesGroup.style.display = 'block';
    }
}
</script>
{% endblock %}